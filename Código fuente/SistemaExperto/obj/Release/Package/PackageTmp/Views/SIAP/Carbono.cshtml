@model IEnumerable<SistemaExperto.Models.SIAP>
    @{
    ViewBag.Title = "Carbono";
    }

    <style>

        .div-contenidohh {
          display: none;
          padding: 10px;
          margin-top: 10px;
        }
        th, td {
            padding: 5px;
            vertical-align: top;
        }

        table {
            border-collapse: separate;
            border-spacing: 5px;
            margin: 0 auto;
        }

        .contenedor-padre-1 {
            display: flex;
        }

        .div-hijo-1 {
            flex: 1; /* Ocupa el mismo espacio disponible en el contenedor padre */
            padding: 10px;
        }

        .panel-heading {
            cursor: pointer;
        }

        .form_productividad {
            border-radius: 5px;
            border-color: #00A99D;
            color: #00A99D;
        }

        .tabs-productividad > li {
            margin-right: 8px;
            font-weight: bold;
        }

            .tabs-productividad > li > a {
                border-color: #3FA9F5 !important;
                padding: 8px 15px;
                border-radius: 5px;
                border-width: 2px !important;
                color: #999999;
                background-color: white;
                cursor: pointer !important;
            }

            .tabs-productividad > li.active > a,
            .tabs-productividad > li.active > a:hover,
            .tabs-productividad > li.active > a:focus {
                color: #3FA9F5;
            }

            .tabs-productividad > li > a:hover {
                color: #3FA9F5;
            }

        .nav-tabs {
            border-bottom: none;
        }

        .panel-principal-productividad {
            height: 99%;
            margin-bottom: 10px;
            min-height: 950px;
        }

        .panel-alto-50 {
            height: 99%;
            padding-bottom: 10px;
            min-height: 950px;
        }

        .panel-alto-100 {
            height: 99%;
            padding-bottom: 10px;
            min-height: 950px;
        }

        .panel-alto-200 {
            height: 99%;
            padding-bottom: 10px;
            min-height: 950px;
        }

        .ui-datepicker-calendar .ui-state-active {
            background: #6eafbf;
            -webkit-box-shadow: inset 0px 0px 10px 0px rgba(0, 0, 0, .1);
            -moz-box-shadow: inset 0px 0px 10px 0px rgba(0, 0, 0, .1);
            box-shadow: inset 0px 0px 10px 0px rgba(0, 0, 0, .1);
            color: #e0e0e0;
            text-shadow: 0px 1px 0px #4d7a85;
            filter: dropshadow(color=#4d7a85, offx=0, offy=1);
            border: 1px solid #55838f;
            position: relative;
            margin: -1px;
        }

        #load {
            width: 100%;
            height: 100%;
            position: fixed;
            z-index: 9999;
            background: url('../Content/imagenes/rueda.gif') no-repeat center center rgba(0,0,0,0.25);
        }

        .deshabilitar-tab {
            pointer-events: none;
        }

        .modal-contenido {
            border-color: #3FA9F5;
        }

        .boton-borde-azul {
            background-color: white;
            border: 2px solid #3FA9F5;
            border-radius: 15px;
            color: #3FA9F5;
            font-size: 1em;
            margin-right: 5px;
        }

        .selectdiv {
            position: relative;
            float: left;
        }

            .selectdiv:after {
                content: '\f107';
                font: normal 200 normal 20px/1 FontAwesome;
                color: #999;
                right: 15px;
                top: 2px;
                height: 34px;
                padding: 10px 10px 10px 8px;
                position: absolute;
                pointer-events: none;
            }

        /* IE11 hide native button */
        select::-ms-expand {
            display: none;
        }

        .selectdiv select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            display: block;
            width: 100%;
            max-width: 320px;
            height: 40px;
            float: right;
            /*margin: 5px -10px;*/
            padding: 0px 35px 0px 5px;
            line-height: 1.75;
            color: #999;
            font-weight: 400;
            font-size: 1em;
            background-color: #ffffff;
            background-image: none;
            border: 2px solid #0ebeff;
            border-radius: 10px;
            -ms-word-break: normal;
            word-break: normal;
        }

        .flechas-caja:after {
            padding: 10px 0px 10px 0px !important;
        }

        .caja-texto {
            border: 2px solid #0ebeff;
            border-radius: 10px;
            height: 40px;
            color: #999;
            font-size: 1em;
        }

        .table {
            margin-bottom: 0px;
        }

        .table-containerhh {
            max-height: 550px; /* Altura máxima del contenedor */
            overflow-y: auto; /* Habilita la scrollbar vertical */
        }

        .dt-buttons {
            padding-top: 15px;
            height: 35px;
            padding-bottom: 25px;
        }

        .popover {
            max-width: 500px;
        }

        #mensaje-carga {
            color: #3FA9F5;
            font-size: 0.85em;
            background-color: white;
            border-radius: 15px;
            padding: 5px 2px 5px 2px;
            margin-bottom: 10px;
        }

        .btn {
            padding: 3px 6px;
        }

        .modal-xl {
            width: 90%;
            max-width: 950px;
        }

        body {
            zoom: 90%;
        }
    </style>

    <div class="container-fluid">
        <div id="sec0" class="row-fluid" style="min-height:1200px;">

            <div id="load"></div>

            <!--Ruta-->
            <div>
                <ol id="breadcrum" class="breadcrumb">
                    <li><a href="~/Inicio/Submenu">Menú</a></li>
                    <li><a href="~/SIAP/Index">SIAP</a></li>
                    <li><a href="~/SIAP/Var_pres">Variables bioclimáticas</a></li>
                    <li><a class="active">Absorción de carbono</a></li>
                </ol>
            </div>

            <!--Título-->
            <div class="col-md-12 text-center" style="height:100px; padding-top:15px; padding-bottom:20px;">
                <span class="color-texto-productividad" style="font-size:2em;">
                    Sistema de Información Agroclimática para Papa - <strong>SIAP</strong>
                    <img style="height:70px;" src="~/Content/imagenes/Iconos/Papaicon.png">
                </span>
            </div>

            <!--Contenido-->
            <div class="col-md-12 panel-principal-productividad">
                <div class="col-md-12 panel-alto-100" style="background-color:#BBA12A; border-radius:10px">

                    <!--Contenido de la página-->
                    <div class="col-md-2" id="panel-mostrar">
                        <div class="col-md-12 text-center" style="background-color: rgba(255,255,255,0.5); margin-bottom:10px; border-radius: 10px; margin-top: 20px">

                            <div class="col-md-12 text-center" style="background-color:white; margin-bottom:10px; border-radius: 10px; margin-top: 20px">
                                <h4 style="color:#3FA9F5; font-weight:bold"><a href="~/Inicio/Submenu">Menú</a></h4>
                            </div>

                            <div class="col-md-12">

                                <!-- Botón -->
                                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#desplegable1" aria-expanded="true" aria-controls="desplegable1">
                                    <div class="boton-desplegable text-center center-block" onclick="window.modalcar.showModal();" style="width: 95%; height:100px; align-items: center; justify-content: center; display: flex;">
                                        Caracterización climática
                                    </div>
                                </a>

                                <!-- Desplegable -->
                                <div id="desplegable1" class="panel-collapse collapse text-center" role="tabpanel" aria-labelledby="heading1">
                                    <div class="panel-body">
                                        <p style="line-height: 10.5;"></p>
                                        <a class="ayuda center-block icono-normal" href="~/SIAP/brillo"
                                           title="Brillo solar" id="icono-brillo">
                                            <img src="~/Content/imagenes/Iconos/brillo_solar.png" width="40" />
                                        </a>
                                        <p style="line-height: 10.5;"></p>
                                        <a class="ayuda center-block icono-normal" href="~/SIAP/Evotrans"
                                           title="Evapotranspiración" id="icono-evapotranspiracion">
                                            <img src="~/Content/imagenes/Iconos/evapotranspiracion.png" width="40" />
                                        </a>
                                        <p style="line-height: 10.5;"></p>
                                        <a class="ayuda center-block icono-normal" href="~/SIAP/Humedadrel"
                                           title="Humedad relativa" id="icono-humedad">
                                            <img src="~/Content/imagenes/Iconos/humedad.png" width="40" />
                                        </a>
                                        <p style="line-height: 10.5;"></p>
                                        <a class="ayuda center-block icono-normal" href="~/SIAP/Precipita"
                                           title="Precipitación" id="icono-pre-multianual">
                                            <img src="~/Content/imagenes/Iconos/precipitaciones.png" width="40" />
                                        </a>
                                        <p style="line-height: 10.5;"></p>
                                        <a class="ayuda center-block icono-normal" href="~/SIAP/Tempmax"
                                           title="Temperatura máxima" id="icono-temp-multianual">
                                            <img src="~/Content/imagenes/Iconos/temperatura.png" width="40" />
                                        </a>
                                        <p style="line-height: 10.5;"></p>
                                        <a class="ayuda center-block icono-normal" href="~/SIAP/Tempmed"
                                           title="Temperatura media" id="icono-temp-multianual">
                                            <img src="~/Content/imagenes/Iconos/temperatura2.png" width="40" />
                                        </a>
                                        <p style="line-height: 10.5;"></p>
                                        <a class="ayuda center-block icono-normal" href="~/SIAP/Tempmin"
                                           title="Temperatura mínima" id="icono-temp-multianual">
                                            <img src="~/Content/imagenes/Iconos/temperatura3.png" width="40" />
                                        </a>
                                        <p style="line-height: 10.5;"></p>
                                        <a class="ayuda center-block icono-normal" href="~/SIAP/Ninonina"
                                           title="Variabilidad climática" id="icono-conglomerados">
                                            <img src="~/Content/imagenes/Iconos/variabilidad.png" width="40" />
                                        </a>
                                        <p style="line-height: 10.5;"></p>
                                    </div>
                                </div>

                                <!-- Sección modelos -->
                                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#desplegable2" aria-expanded="true" aria-controls="desplegable2">
                                    <div class="boton-desplegable text-center center-block" onclick="window.modalcar2.showModal();" style="width: 95%; height:100px; align-items: center; justify-content: center; display: flex;">
                                        Modelos
                                    </div>
                                </a>

                                <!-- Desplegable -->
                                <div id="desplegable2" class="panel-collapse collapse text-center" role="tabpanel" aria-labelledby="heading1">
                                    <div class="panel-body" style="left:50px;">
                                        <p style="line-height: 10.5;"></p>
                                        <a class="ayuda center-block icono-normal" href="~/SIAP/Balancehidri"
                                           title="Balance hídrico" id="icono-brillo">
                                            <img src="~/Content/imagenes/Iconos/drenaje.png" width="40" />
                                        </a>
                                        <p style="line-height: 10.5;"></p>
                                        <a class="ayuda center-block icono-normal" href="~/SIAP/Carbono"
                                           title="Absorción de carbono" id="icono-brillo">
                                            <img src="~/Content/imagenes/Iconos/escenarios.png" width="40" />
                                        </a>
                                    </div>
                                </div>

                                <!-- Sección bioclimaticas -->
                                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#desplegable3" aria-expanded="true" aria-controls="desplegable2">
                                    <div class="boton-desplegable text-center center-block" onclick="window.modalcar4.showModal();" style="width: 95%; height:100px; align-items: center; justify-content: center; display: flex;">
                                        Variables bioclimáticas
                                    </div>
                                </a>

                                <!-- Desplegable -->
                                <div id="desplegable3" class="panel-collapse collapse text-center" role="tabpanel" aria-labelledby="heading1">
                                    <div class="panel-body" style="left:50px;">
                                        <p style="line-height: 10.5;"></p>
                                        <a class="ayuda center-block icono-normal" href="~/SIAP/GDA"
                                           title="Grados Día Acumulados (GDA)" id="icono-brillo">
                                            <img src="~/Content/imagenes/Iconos/clima.png" width="40" />
                                        </a>
                                        <p style="line-height: 10.5;"></p>
                                        <a class="ayuda center-block icono-normal" href="~/SIAP/ISNH"
                                           title="Índice de Satisfacción de Necesidades Hídricas (ISNH)" id="icono-brillo">
                                            <img src="~/Content/imagenes/Iconos/conglomerados.png" width="40" />
                                        </a>
                                    </div>
                                </div>

                                <!-- Sección reconocimiento -->
                                <a class="collapsed" data-toggle="collapse" data-parent="#accordion" aria-expanded="true" aria-controls="desplegable2">
                                    <div class="boton-desplegable text-center center-block" onclick="window.modalcar3.showModal();" style="width: 95%; height:100px; align-items: center; justify-content: center; display: flex;">
                                        Acerca de ...
                                    </div>
                                </a>
                                <br />
                            </div>

                        </div>
                    </div>

                    <!--Modal de referencia-->
                    <dialog id="modalcar3">
                        <div class="modal-lg">
                            <div class="modal-header">
                                <h2 class="modal-title">
                                    Información adicional
                                    <button class="close" type="button" onclick="window.modalcar3.close();">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                </h2>
                            </div>
                            <div class="modal-body" style="text-align: justify;">
                                <p align="justify">
                                    <h4><b>Citación sugerida</b></h4>
                                    Agrosavia. Corporación Colombiana de Investigación Agropecuaria. 2023. Sistema de información agroclimática para papa - SIAP. Disponible en: https: http://semapa.agrosavia.co/NetCorpoicaMVC/SEMapa.
                                </p>

                                <p align="justify">
                                    <h4><b>Créditos</b></h4>
                                <p align="justify">
                                    PhD Ángela M. Castaño M., MSc Henry A. Hernández M., MSc Jhon M. Estupiñán C., MSc Douglas A. Gómez L., Ing. Gerardo A. Goez V., PhD Juan C. Martínez M., MSc Lilia C. Molano B., MSc. Andrea O. Rodriguez R., MSc Gustavo A. Araujo C.
                                </p>
                                <p align="justify">
                                    Los autores contribuyeron en las diferentes fases del sistema: levantamiento y análisis de la información, estructuración y definición de componentes, pilotos, implementación, despliegue y puesta en producción.
                                </p>
                                <p align="justify">
                                    Correo electrónico de contacto: <b>semapa@agrosavia.co</b>.
                                </p>

                                <p align="justify">
                                    <h4><b>Financiamiento</b></h4>
                                    El SIAP es producto de los esfuerzos de Agrosavia a través de la financiación de los proyectos 1000911 y 1001268.
                                </p>

                                <p align="justify">
                                    <h4><b>Agradecimientos</b></h4>
                                    El equipo de trabajo del SIAP agradece las contribuciones en la implementación del sistema a las siguientes empresas:
                                    <ul style="list-style-type: none;">
                                        <li style="text-align:left;">
                                            Finca Caseteja
                                        </li>
                                        <li style="text-align:left;">
                                            <br />
                                            <div style="display: flex;">
                                                <div>
                                                    Finca La Fortuna &nbsp;
                                                </div>
                                                <div>
                                                    <img class="img-responsive" height="120" width="140" src="~/Content/imagenes/logos/fortuna.png" />
                                                </div>
                                            </div>
                                        </li>

                                        <li style="text-align:left;">
                                            <br />
                                            <div style="display: flex;">
                                                <div>
                                                    PEPSICO &nbsp;
                                                </div>
                                                <div>
                                                    <img class="img-responsive" height="120" width="140" src="~/Content/imagenes/logos/PepsiCo.jpg" />
                                                </div>
                                            </div>
                                        </li>

                                        <li style="text-align:left;">
                                            <br />
                                            <div style="display: flex;">
                                                <div>
                                                    McCain &nbsp;
                                                </div>
                                                <div>
                                                    <img class="img-responsive" height="120" width="140" src="~/Content/imagenes/logos/McCain.png" />
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </p>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" onclick="window.modalcar3.close();">Salir</button>
                            </div>
                        </div>
                    </dialog>

                    <!--Contenido de la página-->
                    <div class="col-md-10 panel-alto-50" id="panel-mostrar">
                        <div class="col-md-12 text-center panel-alto-50" style="background-color: rgba(255,255,255,0.5); margin-bottom:10px; border-radius: 10px; margin-top: 20px">

                            <div class="col-md-12 text-center" style="background-color:white; margin-bottom:10px; border-radius: 10px; margin-top: 20px; ">
                                <h4 style="color:#3FA9F5; font-weight:bold; ">Absorción de carbono</h4>
                            </div>

                            <!--Leyenda-->
                            <div class="col-md-12 text-center" style="background-color:white; margin-bottom:10px; border-radius: 10px; margin-top: 20px">
                                <!--Modal-->
                                <div id="modal" class="modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-lg" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel">Información para el usuario</h5>
                                            </div>
                                            <div class="modal-body" style="text-align: center;">
                                                <div class="alert alert-danger">
                                                    <strong>Aviso!</strong>

                                                    <div id="Aviso_modal">Error</div>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button class="btn btn-secondary" type="button" data-dismiss="modal">Volver a SIAP</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!--Menu de selección-->
                                <ul class="nav nav-tabs tabs-productividad" role="tablist" id="tabs-resultados" style="margin-top: 20px">
                                    <li role="presentation">
                                        <a class="estilo_tabs" id="nav-P2-tab" data-toggle="tab" href="#nav-2" role="tab" aria-controls="nav-P2" style="text-align: center;">Panel de usuario</a>
                                    </li>
                                    <li role="presentation">
                                        <a class="estilo_tabs" id="nav-P3-tab" data-toggle="tab" href="#nav-3" role="tab" aria-controls="nav-P3" style="text-align: center;">Resultados</a>
                                    </li>
                                    <!--<li role="presentation">
                                        <a class="estilo_tabs" id="nav-P4-tab" data-toggle="tab" href="#nav-4" role="tab" aria-controls="nav-P4" style="text-align: center;">Parámetros</a>
                                    </li>-->
                                    <li role="presentation">
                                        <a class="estilo_tabs" id="nav-P1-tab" data-toggle="tab" href="#nav-1" role="tab" aria-controls="nav-P1" style="text-align: center;">Descripción</a>
                                    </li>
                                </ul>

                                <div class="tab-content" id="nav-tabContent">
                                    <div class="tab-pane fade" id="nav-1" role="tabpanel" aria-labelledby="nav-P1-tab">
                                        <div class="card border-info mb-3">
                                            <div class="card-body text-info">
                                                <h2><strong>Descripción del producto</strong></h2>
                                                <p style="text-align: justify; font-size:110%;">
                                                    El modelo de simulación de la Productividad Primaria Bruta (PPB) para plantas de papa Diacol Capiro es una herramienta que permite predecir la cantidad de carbono fijado a través de la fotosíntesis bajo diferentes condiciones de suministro hídrico. Utiliza la ecuación de respuesta a la Luz de Mitscherlich, con la radiación fotosintéticamente activa como entrada. 
                                                    Este modelo ofrece tres escenarios de suministro hídrico: bajo riego bien aplicado según la demanda calculada por el balance hídrico, escasez hídrica y riego insuficiente. Su salida es la cantidad de carbono fijado en toneladas de CO<sub>2</sub> por hectárea, lo que refleja la eficiencia fotosintética del cultivo.
                                                </p>
                                                <p style="text-align: justify; font-size:110%;">
                                                    La importancia de este modelo radica en su capacidad para estimar cómo las condiciones hídricas afectan directamente la productividad del cultivo. Conocer la cantidad de carbono absorbido es esencial para entender el rendimiento de las plantas de papa. El modelo proporciona información valiosa para la toma de decisiones agrícolas, permitiendo ajustar prácticas de riego para optimizar la producción y minimizar los impactos ambientales al maximizar la eficiencia en la fijación de carbono.
                                                </p>
                                                <p style="text-align: justify; font-size:110%;">
                                                    El modelo de simulación de la Productividad Primaria Bruta (PPB) para plantas de papa Diacol Capiro fue desarrollado como resultado de investigaciones realizadas en fincas de productores de papa en Sabana de Occidente, departamento de Cundinamarca, Colombia. Estas investigaciones involucraron la evaluación de cuatro ciclos de cultivo, llevados a cabo bajo diferentes condiciones de suministro hídrico. Utilizando datos de estos ciclos, se pudo ajustar y validar el modelo, lo que aumenta su precisión y relevancia para el contexto local.
                                                </p>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="tab-pane fade in active" id="nav-2" role="tabpanel" aria-labelledby="nav-P2-tab">
                                        <h1><strong>Panel de usuario</strong></h1>

                                        <!-- Campos de entrada -->
                                        <div class="row">

                                            <div class="col-lg-6 col-md-6 mb-3">

                                                <div style="border-style: double;">
                                                    <div>
                                                        <h2><strong>Datos de entrada</strong></h2>
                                                    </div>

                                                    <div class="contenedor-padre-1">
                                                        <div class="div-hijo-1">
                                                            <p> <b>Fecha de la siembra:</b> </p>
                                                        </div>
                                                        <div class="div-hijo-1">
                                                            <input title="Día 1 del cultivo de papa" type="date" id="Fechao" name="Fechao" min="2019-01-01" style="text-align:center; width: 90%;" />
                                                        </div>
                                                    </div>

                                                    <div class="contenedor-padre-1">
                                                        <div class="div-hijo-1">
                                                            <p> <b>Condición hídrica:</b> </p>
                                                        </div>
                                                        <div class="div-hijo-1">
                                                            <select title="Seleccione tipo de riego" id="Riego" style="text-align: center; width: 90%;">
                                                                <option value=0 selected>Riego por demanda</option>
                                                                <option value=1>Riego calendarizado</option>
                                                                <option value=2>Secano</option>
                                                                <!--<option value=1>Ejemplo</option>-->
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div class="contenedor-padre-1">
                                                        <div class="div-hijo-1">
                                                            <p> <b>Seleccione histórico de radiación:</b> </p>
                                                        </div>
                                                        <div class="div-hijo-1">
                                                            <input type="file" id="fileInput" accept=".xlsx">
                                                        </div>
                                                    </div>

                                                    <div class="contenedor-padre-1">
                                                        <div class="div-hijo-1">
                                                            <p> <b>Realizar la simulación:</b> </p>
                                                        </div>
                                                        <div class="div-hijo-1">
                                                            <button onclick="actualizar_pag()" class="btn btn-info">Clic para actualizar la página</button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div style="border-style: double;">
                                                    <div>
                                                        <h2><strong>Recomendaciones</strong></h2>
                                                    </div>

                                                    <div>
                                                        <p>En este enlace <u><a href="~/Content/ArchivoPrueba.xlsx" download="ArchivoPrueba.xlsx">encontrará</a></u> un archivo con registros en formato *.xlsx.
                                                            Este archivo contiene los registros de mediciones hechas en un sistema productivo cuya fecha de siembra es el 28 de febrero de 2020 con un tipo de riego 
                                                            calendarizado.                                                        
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-lg-6 col-md-6 mb-3">
                                                <div style="border-style: double;">
                                                    <div>
                                                        <h2><strong>Vista preliminar</strong></h2>
                                                    </div>
                                                    <div class="table-containerhh" id="tableContainer">Seleccione datos de entrada</div>
                                                </div>
                                            </div>
                                        </div>
                                        <br>
                                    </div>

                                    <div class="tab-pane fade" id="nav-3" role="tabpanel" aria-labelledby="nav-P3-tab">

                                        <div class="row">
                                            <h2><strong>Gráficas de salida</strong></h2>
                                            <div style="border-style: double;">
                                                <div id="GraficaGPP1" style="width: 90%; display: flex; justify-content: center; align-items: center; height: 500px;"></div>
                                                <div id="GraficaGPP2" style="width: 90%; display: flex; justify-content: center; align-items: center; height: 500px;"></div>
                                            </div>
                                        </div>
                                        <!-- Tablas re resultados -->
                                        <div class="row">

                                            <h2><strong>Vista preliminar</strong></h2>
                                            <div style="border-style: double;">
                                                <button onclick="Exportarcsv('Resultados.csv','4')" class="btn btn-warning">Descargar información del consolidado</button>
                                                <br />
                                                <div class="table-containerhh" id="tableContainer2">Seleccione datos de entrada</div>
                                            </div>

                                        </div>

                                    </div>

                                    <div class="tab-pane fade" id="nav-4" role="tabpanel" aria-labelledby="nav-P4-tab">

                                        <button onclick="mostrarDiv(1)">Epsilon</button>
                                        <button onclick="mostrarDiv(2)">FCsat</button>
                                        <button onclick="mostrarDiv(3)">RD</button>

                                        <div class="div-contenidohh" id="Tablamodel1">
                                            <h1><strong>Coeficientes Epsilon</strong></h1>
                                            <div style="border-style: double;" id="tabladiv">
                                                <button onclick="Exportarcsv('CoefEpsilon.csv','1')" class="btn btn-warning">Descargar información del consolidado</button>
                                                <br />
                                                <div class="table-containerhh">
                                                    <table id="tab_reporte1"></table>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="div-contenidohh" id="Tablamodel2">
                                            <h1><strong>Coeficientes FCsat</strong></h1>
                                            <div style="border-style: double;" id="tabladiv">
                                                <button onclick="Exportarcsv('CoefFCsat.csv','2')" class="btn btn-warning">Descargar información del consolidado</button>
                                                <br />
                                                <div class="table-containerhh">
                                                    <table id="tab_reporte2"></table>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="div-contenidohh" id="Tablamodel3">
                                            <h1><strong>Coeficientes RD</strong></h1>
                                            <div style="border-style: double;" id="tabladiv">
                                                <button onclick="Exportarcsv('CoefRD.csv','3')" class="btn btn-warning">Descargar información del consolidado</button>
                                                <br />
                                                <div class="table-containerhh">
                                                    <table id="tab_reporte3"></table>
                                                </div>
                                            </div>
                                        </div>

                                    </div>


                                </div>

                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

<!-- Créditos -->
<div class="seccion-logos" id="sec1">
    <div class="container">
        <!--Logos-->
        <div class="row hidden-xs" style="background-color:white; padding: 10px 0 10px 0; height:100px; margin-top:0px;">
            <div class="col-md-4 col-sm-4 cuadro-logo">
                <img class="imagen-logo" src="~/Content/imagenes/Logos/fondo_adaptacion.png" />
            </div>
            <div class="col-md-4 col-sm-4 cuadro-logo">
                <img class="imagen-logo" src="~/Content/imagenes/Logos/LogoMADR.png" />
            </div>
            <div class="col-md-4 col-sm-4 cuadro-logo">
                <img class="imagen-logo" src="~/Content/imagenes/Logos/logo-agrosavia.png" />
            </div>
        </div>
    </div>
</div>

    <!-- Bootstrap core JavaScript-->
    <script src="~/Scripts/vendor/jquery/jquery.min.js"></script>
    <script src="~/Scripts/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- Core plugin JavaScript-->
    <script src="~/Scripts/vendor/jquery-easing/jquery.easing.min.js"></script>
    <!-- Scripts personalizados for all pages-->
    <script src="~/Scripts/js/sb-admin-2.min.js"></script>

    <!-- Fuentes-->
    <link href="~/Scripts/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

    <!--Graficos-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.2/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/510/fabric.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <script>
        //document.getElementById('fileInput').addEventListener('change', handleFile);
        function leerarchxls(){
        //function handleFile(event) {
            const input = document.getElementById('fileInput');
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });

                    // Supongamos que el archivo contiene una sola hoja, si hay varias, puedes acceder a ellas con workbook.SheetNames
                    const sheet = workbook.Sheets[workbook.SheetNames[0]];

                    // Convertir los datos de la hoja en formato JSON
                    const jsonData = XLSX.utils.sheet_to_json(sheet);
                    //Variables de salida
                    var Etapa_sal = [];
                    var Fecha_sal = [];
                    var dds_sal = [];
                    var GPP_diar_sal = [];
                    var FCSat_sal = [];
                    var Rd_sal = [];
                    var Epsi_sal = [];
                    var GPP_Acum = [];

                    const jsonsalidaaux = [];
                    const CondiH = parseInt(document.getElementById('Riego').value);
                    var Textoconh = "1-Optima" 
                    if(CondiH==0){Textoconh = "1-Optima";}
                    if(CondiH==1){Textoconh = "2-Intermedia";}
                    if(CondiH==2){Textoconh = "3-Seca";}

                    // Formatear las fechas en el JSON (asumiendo que la primera columna contiene timestamps en segundos)
                    let fechajson1="";
                    jsonData.forEach((row) => {
                        row.TIMESTAMP = convertToDateTime(row.TIMESTAMP);
                        fechajson1  = row.TIMESTAMP.substring(0, 10);
                        row.DDS = calculateDaysDifference(fechajson1)+1;
                        row.Etapa = Identificar_Etapa(row.DDS);
                        //Calcular Epsilon
                        row.EPSat_Dia = Calcular_Epsilon(row.DDS, Tomar_coeficientes(row.Etapa, Textoconh, Coef_1q));
                        //FC
                        row.FCSat_Dia = Calcular_FCsat(row.DDS, Tomar_coeficientes(row.Etapa, Textoconh, Coef_2q));
                        //RD
                        row.RDSat_Dia = Calcular_Rd(row.DDS, Tomar_coeficientes(row.Etapa, Textoconh, Coef_3q));
                        //GPP Dia
                        row.GPP_Dia = Calcular_GPP(row.FCSat_Dia, row.RDSat_Dia, row.EPSat_Dia, row.PAR)*1800;
                    });             


                    // Crear una tabla HTML con los datos
                    const table = createTableFromJSON(jsonData);

                    // Mostrar la tabla en el contenedor
                    const tableContainer = document.getElementById('tableContainer');
                    tableContainer.innerHTML = '';
                    tableContainer.appendChild(table);
                    const TablaGPP = calcularGPPDiario(jsonData);
                    const table2 = createTableFromJSON(TablaGPP);

                    // Mostrar la tabla en el contenedor
                    const tableContainer2 = document.getElementById('tableContainer2');
                    tableContainer2.innerHTML = '';
                    table2.id = "tab_reporte4"; 
                    tableContainer2.appendChild(table2);

                    //Graficar
                    plotData(TablaGPP)

                };

                reader.readAsArrayBuffer(file);
            }
        }

        // Función para graficar los datos
        function plotData(data) {
            var EtapaDDS = data.map(item => item.EtapaSiembra);
            //var DDSvar= data.map(item => item.DiaS);
            var xData1 = data.map(item => item.fecha);
            var xData2 = data.map(item => item.DiaS);
            var yData1 = data.map(item => item.GPP_Diaria);
            var yData2 = data.map(item => item.GPP_acumulado);

            
            // Clasificar los datos según la región
            const DataHist1 = [...new Set(EtapaDDS)];

            const DatabyEta = DataHist1.map(ETAaux => {
                const FiltroxData0 = xData1.filter((_, index) => EtapaDDS[index] === ETAaux);
                const FiltroxData1 = xData2.filter((_, index) => EtapaDDS[index] === ETAaux);
                const FiltroyData2 = yData1.filter((_, index) => EtapaDDS[index] === ETAaux);

                return {
                    z: FiltroxData0,
                    x: FiltroxData1,
                    y: FiltroyData2,
                    type: 'bar',
                    name: ETAaux,
                };
            });

            const DatabyEtaAcu = DataHist1.map(ETAaux => {
                const FiltroxData0 = xData1.filter((_, index) => EtapaDDS[index] === ETAaux);
                const FiltroxData1 = xData2.filter((_, index) => EtapaDDS[index] === ETAaux);
                const FiltroyData2 = yData2.filter((_, index) => EtapaDDS[index] === ETAaux);

                return {
                    z: FiltroxData0,
                    x: FiltroxData1,
                    y: FiltroyData2,
                    type: 'bar',
                    name: ETAaux,
                };
            });

            var trace1 = {
                x: DatabyEta[0].x,
                y: DatabyEta[0].y,
                type: 'bar',
                name: '1-Brotación',
                marker: {
                    color: 'yellow' 
                },
                xaxis: 'x1'
            };

            var trace2 = {
                x: DatabyEta[1].x,
                y: DatabyEta[1].y,
                type: 'bar',
                name: '2-Vegetativa',
                marker: {
                    color: 'blue' 
                },
                xaxis: 'x1'
            };

            var trace3 = {
                x: DatabyEta[2].x,
                y: DatabyEta[2].y,
                type: 'bar',
                name: '3-Tuberización',
                marker: {
                    color: 'green' 
                },
                xaxis: 'x1'
            };

            var trace4 = {
                x: DatabyEta[3].x,
                y: DatabyEta[3].y,
                type: 'bar',
                name: '4-Llenado de tubérculos',
                marker: {
                    color: 'red' 
                },
                xaxis: 'x1'
            };

            var trace1a = {
                x: DatabyEta[0].z,
                y: DatabyEta[0].y,
                type: 'bar',
                name: '1-Brotación',
                showlegend: false,
                marker: {
                    color: 'yellow' 
                },
                xaxis: 'x2'
            };

            var trace2a = {
                x: DatabyEta[1].z,
                y: DatabyEta[1].y,
                type: 'bar',
                name: '2-Vegetativa',
                showlegend: false,
                marker: {
                    color: 'blue' 
                },
                xaxis: 'x2' 
            };

            var trace3a = {
                x: DatabyEta[2].z,
                y: DatabyEta[2].y,
                type: 'bar',
                name: '3-Tuberización',
                showlegend: false,
                marker: {
                    color: 'green' 
                },
                xaxis: 'x2' 
            };

            var trace4a = {
                x: DatabyEta[3].z,
                y: DatabyEta[3].y,
                type: 'bar',
                name: '4-Llenado de tubérculos',
                showlegend: false,
                marker: {
                    color: 'red' 
                },
                xaxis: 'x2' 
            };

            var trace5 = {
                x: DatabyEtaAcu[0].x,
                y: DatabyEtaAcu[0].y,
                mode: 'lines',
                type: 'scatter',
                name: '1-Brotación',
                marker: {
                    color: 'yellow' 
                },
                xaxis: 'x1'
            };

            var trace6 = {
                x: DatabyEtaAcu[1].x,
                y: DatabyEtaAcu[1].y,
                mode: 'lines',
                type: 'scatter',
                name: '2-Vegetativa',
                marker: {
                    color: 'blue' 
                },
                xaxis: 'x1'
            };

            var trace7 = {
                x: DatabyEtaAcu[2].x,
                y: DatabyEtaAcu[2].y,
                mode: 'lines',
                type: 'scatter',
                name: '3-Tuberización',
                marker: {
                    color: 'green' 
                },
                xaxis: 'x1'
            };

            var trace8 = {
                x: DatabyEtaAcu[3].x,
                y: DatabyEtaAcu[3].y,
                mode: 'lines',
                type: 'scatter',
                name: '4-Llenado de tubérculos',
                marker: {
                    color: 'red' 
                },
                xaxis: 'x1'
            };

            var trace5a = {
                x: DatabyEtaAcu[0].z,
                y: DatabyEtaAcu[0].y,
                mode: 'lines',
                type: 'scatter',
                name: '1-Brotación',
                showlegend: false,
                marker: {
                    color: 'yellow' 
                },
                xaxis: 'x2' 
            };

            var trace6a = {
                x: DatabyEtaAcu[1].z,
                y: DatabyEtaAcu[1].y,
                mode: 'lines',
                type: 'scatter',
                name: '2-Vegetativa',
                showlegend: false,
                marker: {
                    color: 'blue' 
                },
                xaxis: 'x2' 
            };

            var trace7a = {
                x: DatabyEtaAcu[2].z,
                y: DatabyEtaAcu[2].y,
                mode: 'lines',
                type: 'scatter',
                name: '3-Tuberización',
                showlegend: false,
                marker: {
                    color: 'green' 
                },
                xaxis: 'x2' 
            };

            var trace8a = {
                x: DatabyEtaAcu[3].z,
                y: DatabyEtaAcu[3].y,
                mode: 'lines',
                type: 'scatter',
                name: '4-Llenado de tubérculos',
                showlegend: false,
                marker: {
                    color: 'red' 
                },
                xaxis: 'x2' 
            };

            var layout1 = {
                width: 950,
                title: 'PPB Diaria',
                xaxis: {title: 'DDS (d)'},
                xaxis2: {
                    overlaying: 'x', // Superpone el segundo eje x sobre el eje principal
                    side: 'top' // Coloca el segundo eje x en la parte superior del gráfico
                },
                yaxis: {title: 'PPB (t CO₂ ha⁻¹)'},
                legend: {
                    x: 0, // Cambia este valor para ajustar la ubicación horizontal de la leyenda
                    y: -1,  // Cambia este valor para ajustar la ubicación vertical de la leyenda
                    traceorder: 'normal',
                    font: {
                        family: 'Arial, sans-serif',
                        size: 12
                    }}
            };

            var layout2 = {
                width: 950,
                title: 'PPB Acumulada',
                xaxis: {title: 'DDS (d)'},
                xaxis2: {
                    overlaying: 'x', // Superpone el segundo eje x sobre el eje principal
                    side: 'top' // Coloca el segundo eje x en la parte superior del gráfico
                },
                yaxis: {
                    title: 'PPB (t CO₂ ha⁻¹)'
                },
                legend: {
                    x: 0, // Cambia este valor para ajustar la ubicación horizontal de la leyenda
                    y: -1,  // Cambia este valor para ajustar la ubicación vertical de la leyenda
                    traceorder: 'normal',
                    font: {
                        family: 'Arial, sans-serif',
                        size: 12
                    }}
            };

            // Renderizar las gráficas en el div deseado
            var data = [trace1a, trace2a, trace3a, trace4a, trace1, trace2, trace3, trace4];
            Plotly.newPlot('GraficaGPP1', data, layout1);
            data = [trace5a, trace6a, trace7a, trace8a, trace5, trace6, trace7, trace8];
            Plotly.newPlot('GraficaGPP2', data, layout2);
        }

        function Tomar_coeficientes(columna1Valor, columna2Valor, jsonData) {
            return jsonData.find(
              item => item.Etapa === columna1Valor && item.Condicion === columna2Valor
            );
        }
        
        function calcularGPPDiario(GPP_In) {
            const AcumuladosGPPDiarios = {};
            const DDiasSiembra = {};
            const CoefEP = {};
            const CoefFC = {};
            const CoefSA = {};
            const EtapaS = {};
            GPP_In.forEach(item => {
                const fecha = item.TIMESTAMP.substring(0, 10);
                if (!AcumuladosGPPDiarios[fecha]) {
                    DDiasSiembra[fecha] = item.DDS;
                    CoefEP[fecha] = { total: item.EPSat_Dia};
                    CoefFC[fecha] = { total: item.FCSat_Dia};
                    CoefSA[fecha] = { total: item.RDSat_Dia};
                    AcumuladosGPPDiarios[fecha] = { total: item.GPP_Dia, contador: 1 };
                    EtapaS[fecha] =  item.Etapa;
                } else {
                    AcumuladosGPPDiarios[fecha].total += item.GPP_Dia;
                    AcumuladosGPPDiarios[fecha].contador++;
                    CoefEP[fecha].total += item.EPSat_Dia;
                    CoefFC[fecha].total += item.FCSat_Dia;
                    CoefSA[fecha].total += item.RDSat_Dia;
                }
            });

            // Calcular el promedio diario y crear una nueva tabla con las fechas y los promedios
            const tablaAcumulados = [];
            var GPP_acumulado=0;
            for (const fecha in AcumuladosGPPDiarios) {
                const EtapaSiembra = EtapaS[fecha];
                const DiaS = DDiasSiembra[fecha];
                const GPP_Diaria = AcumuladosGPPDiarios[fecha].total/100000;
                const FC_Sat = CoefFC[fecha].total/AcumuladosGPPDiarios[fecha].contador;
                const RD = CoefSA[fecha].total/AcumuladosGPPDiarios[fecha].contador;
                const Epsilon = CoefEP[fecha].total/AcumuladosGPPDiarios[fecha].contador;
                if (isNaN(GPP_Diaria)) {
                    break;
                } else {
                    GPP_acumulado += GPP_Diaria;
                }
                tablaAcumulados.push({EtapaSiembra, fecha, DiaS, GPP_Diaria, FC_Sat, RD, Epsilon, GPP_acumulado});
            }

            return tablaAcumulados;
        }

        function Calcular_GPP(FCsat,Rd,Epsilon,PAR){
            if (PAR<2.5){
                return 0;
            }
            else{
                return (FCsat+Rd)*(1 - Math.exp((-Epsilon*PAR)/(FCsat+Rd)));
            }
            }

        function convertToDateTime(number) {
            const excelEpoch = new Date(Date.UTC(1899, 11, 30));
            const millisecondsPerDay = 24 * 60 * 60 * 1000;
            const dateValue = Math.floor(number);
            const timeValue = (number - dateValue) * millisecondsPerDay;
            const resultDate = new Date(excelEpoch.getTime() + dateValue * millisecondsPerDay + timeValue);
            return resultDate.toISOString().slice(0, 16).replace("T", " ");
        }

        function createTableFromJSON(jsonData) {
            const table = document.createElement('table');
            const tableHead = document.createElement('thead');
            const tableBody = document.createElement('tbody');

            // Crea las filas del encabezado de la tabla
            const headRow = document.createElement('tr');
            Object.keys(jsonData[0]).forEach((key) => {
                const th = document.createElement('th');
                th.textContent = key;
                headRow.appendChild(th);
            });
            tableHead.appendChild(headRow);

            // Crea las filas de datos de la tabla
            jsonData.forEach((row) => {
                const dataRow = document.createElement('tr');
                Object.values(row).forEach((value) => {
                    const td = document.createElement('td');
                    td.textContent = value;
                    dataRow.appendChild(td);
                });
                tableBody.appendChild(dataRow);
            });

            table.appendChild(tableHead);
            table.appendChild(tableBody);

            return table;
        }

        function calculateDaysDifference(Fecha_ini) {
            const baseDate = new Date(Fecha_ini);
            const userInput = document.getElementById("Fechao").value;
            const userDate = new Date(userInput);
            console.log(baseDate);
            console.log(userDate);

            if (isNaN(userDate)) {
                console.log("Fecha ingresada inválida.");
            } else {
                const differenceInMilliseconds = Math.abs(userDate - baseDate);
                console.log(differenceInMilliseconds);
                const differenceInDays = differenceInMilliseconds / (1000 * 60 * 60 * 24);
                console.log(differenceInDays);
                return differenceInDays.toFixed(0)-1;
            }
            
        }
        
        function Identificar_Etapa(dds) {
            var riehh=0;
            riehh = document.getElementById("Riego").value;
            if (riehh == 1) {
                if (dds < 28) {
                    Etapaveg = "1-Brotacion"
                }
                else {
                    if (dds < 67) {
                        Etapaveg = "2-Vegetativa"
                    }
                    else {
                        if (dds < 114) {
                            Etapaveg = "3-Tuberizacion"
                        }
                        else {
                            Etapaveg = "4-Llenado de tuberculos"
                        }
                    }
                }
            }
            if (riehh == 2) {
                if (dds < 25) {
                    Etapaveg = "1-Brotacion"
                }
                else {
                    if (dds < 71) {
                        Etapaveg = "2-Vegetativa"
                    }
                    else {
                        if (dds < 98) {
                            Etapaveg = "3-Tuberizacion"
                        }
                        else {
                            Etapaveg = "4-Llenado de tuberculos"
                        }
                    }
                }
            }
            if (riehh == 0) {
                if (dds < 28) {
                    Etapaveg = "1-Brotacion"
                }
                else {
                    if (dds < 67) {
                        Etapaveg = "2-Vegetativa"
                    }
                    else {
                        if (dds < 114) {
                            Etapaveg = "3-Tuberizacion"
                        }
                        else {
                            Etapaveg = "4-Llenado de tuberculos"
                        }
                    }
                }
            }
            return (Etapaveg)
        }

        function Calcular_FCsat(dds, Modelo) {
            let FCsat;
            if (Modelo.FCsat_Tipo === "Constante") {
                FCsat = Modelo.FCsat_B0;
            } else if (Modelo.FCsat_Tipo === "Lineal") {
                FCsat = Modelo.FCsat_B0 + (dds * Modelo.FCsat_B1);
            } else if (Modelo.FCsat_Tipo === "Box") {
                const Aux = Modelo.FCsat_B0 + (dds * Modelo.FCsat_B1) + (Modelo.FCsat_B2 * Math.pow(dds, 2)) + (Modelo.FCsat_B3 * Math.pow(dds, 3));
                FCsat = Math.pow((Modelo.FCsat_Lambda * Aux) + 1, (1 / Modelo.FCsat_Lambda));
            } else if (Modelo.FCsat_Tipo === "Polinomial") {
                FCsat = Modelo.FCsat_B0 + (dds * Modelo.FCsat_B1) + (Modelo.FCsat_B2 * Math.pow(dds, 2)) + (Modelo.FCsat_B3 * Math.pow(dds, 3));
            }
            return FCsat;
        }

        function Calcular_Rd(dds, Modelo) {
            let Rd;
            if (Modelo.RD_Tipo === "Constante") {
                Rd = Modelo.RD_B0;
            } else if (Modelo.RD_Tipo === "Lineal") {
                Rd = Modelo.RD_B0 + (dds * Modelo.RD_B1);
            } else if (Modelo.RD_Tipo === "Box") {
                const Aux = Modelo.RD_B0 + (dds * Modelo.RD_B1) + (Modelo.RD_B2 * Math.pow(dds, 2)) + (Modelo.RD_B3 * Math.pow(dds, 3));
                Rd = Math.pow((Modelo.RD_Lambda * Aux) + 1, 1 / Modelo.RD_Lambda);
            } else if (Modelo.RD_Tipo === "Polinomial") {
                Rd = Modelo.RD_B0 + (dds * Modelo.RD_B1) + (Modelo.RD_B2 * Math.pow(dds, 2)) + (Modelo.RD_B3 * Math.pow(dds, 3));
            }
            return Rd;
        }

        function Calcular_Epsilon(dds, Modelo) {
            let Epsilon;
            if (Modelo.Eps_Tipo === "Constante") {
                Epsilon = Modelo.Eps_B0;
            } else if (Modelo.Eps_Tipo === "Lineal") {
                Epsilon = Modelo.Eps_B0 + (dds * Modelo.Eps_B1);
            } else if (Modelo.Eps_Tipo === "Box") {
                const Aux = Modelo.Eps_B0 + (dds * Modelo.Eps_B1) + (Modelo.Eps_B2 * Math.pow(dds, 2)) + (Modelo.Eps_B3 * Math.pow(dds, 3));
                Epsilon = Math.pow((Modelo.Eps_Lambda * Aux) + 1, 1 / Modelo.Eps_Lambda);
            } else if (Modelo.Eps_Tipo === "Polinomial") {
                Epsilon = Modelo.Eps_B0 + (dds * Modelo.Eps_B1) + (Modelo.Eps_B2 * Math.pow(dds, 2)) + (Modelo.Eps_B3 * Math.pow(dds, 3));
            }
            return Epsilon;
        }

    </script>

    <script type="text/javascript" src="~/Scripts/Carbonomodel.js"></script>

    <script>
    $(document).ready(function () {
        $('#load').hide();
    });
    </script>

    <a class="boton-subir off" href="#">
        <span class="icon-fastup">
        </span> Volver al mapa
    </a>
